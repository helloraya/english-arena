<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENGLISH 8 ARENA | Ms. Raya</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- THEME: BLACK, WHITE, YELLOW --- */
        :root {
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --primary-yellow: #F4D03F;
            --text-white: #FFFFFF;
            --text-gray: #B0B0B0;
            --accent-red: #E74C3C;
            --accent-green: #2ECC71;
            --border-color: #333333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            font-family: 'Poppins', sans-serif;
            color: var(--text-white);
            overflow-x: hidden;
            background-image: radial-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* --- UTILS --- */
        .glass-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .section-title { font-family: 'Fredoka', sans-serif; font-size: 2rem; color: var(--primary-yellow); text-align: center; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 2px; }
        .section-subtitle { text-align: center; color: var(--text-gray); margin-bottom: 2rem; font-size: 0.9rem; }

        /* --- NAVIGATION --- */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 5%; position: fixed; width: 100%; top: 0; z-index: 100;
            background: rgba(18, 18, 18, 0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
        }
        .logo { font-family: 'Fredoka', sans-serif; font-size: 1.2rem; color: var(--text-white); font-weight: 600; display:flex; align-items:center; gap:10px; }
        .logo i { color: var(--primary-yellow); }

        /* --- HERO SECTION --- */
        .hero { min-height: 80vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 100px 20px 50px; text-align: center; }
        
        /* SEARCH BAR AUTO-COMPLETE */
        .search-wrapper { position: relative; width: 100%; max-width: 500px; margin-bottom: 30px; }
        .search-box {
            width: 100%; padding: 15px 25px; border-radius: 50px; border: 2px solid var(--border-color);
            background: #000; color: white; font-size: 1.1rem; font-family: 'Poppins'; outline: none;
            text-align: center; transition: 0.3s;
        }
        .search-box:focus { border-color: var(--primary-yellow); box-shadow: 0 0 15px rgba(244, 208, 63, 0.3); }
        
        .suggestions-box {
            position: absolute; top: 110%; left: 0; width: 100%;
            background: #1A1A1A; border: 1px solid #333; border-radius: 12px;
            overflow: hidden; z-index: 10; display: none;
        }
        .suggestion-item { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #333; text-align: left; transition: 0.2s; }
        .suggestion-item:hover { background: #333; color: var(--primary-yellow); }

        /* VOCAB CARD */
        .vocab-card {
            background: linear-gradient(135deg, #1A1A1A, #252525); border-left: 4px solid var(--primary-yellow);
            padding: 20px; border-radius: 12px; max-width: 600px; width: 100%; margin-bottom: 30px; text-align: left;
            position: relative; overflow: hidden;
        }
        .vocab-word { font-family: 'Fredoka'; font-size: 1.5rem; color: var(--primary-yellow); margin-bottom: 5px; }
        .vocab-meaning { font-style: italic; color: #ccc; margin-bottom: 10px; }
        .vocab-example { font-size: 0.9rem; color: #888; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px; }

        /* --- LEADERBOARD & LIST --- */
        .podium-container { display: flex; justify-content: center; align-items: flex-end; gap: 15px; margin-bottom: 3rem; min-height: 350px; }
        .podium-card { 
            text-align: center; padding: 1.5rem; width: 30%; max-width: 200px;
            background: var(--card-bg); border-radius: 16px; border: 1px solid #333;
            display: flex; flex-direction: column; justify-content: center; position: relative; cursor: pointer; transition: 0.3s;
        }
        .podium-card:hover { transform: translateY(-5px); border-color: var(--primary-yellow); }
        
        .rank-1 { height: 320px; border: 2px solid var(--primary-yellow); box-shadow: 0 0 20px rgba(244, 208, 63, 0.1); order: 2; z-index: 2; transform: translateY(-20px); }
        .rank-2 { height: 260px; border-bottom: 4px solid #C0C0C0; order: 1; }
        .rank-3 { height: 220px; border-bottom: 4px solid #CD7F32; order: 3; }
        
        .list-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 900px; margin: 0 auto; }
        .player-row {
            background: #1A1A1A; padding: 15px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between;
            border: 1px solid #333; transition: 0.2s; cursor: pointer;
        }
        .player-row:hover { background: #222; border-color: var(--primary-yellow); }

        /* --- MENU GRID --- */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; max-width: 800px; margin: 40px auto; padding: 0 20px; }
        .menu-btn {
            background: #1E1E1E; padding: 20px 10px; border-radius: 16px; text-align: center; cursor: pointer; transition: 0.3s; border: 1px solid #333;
        }
        .menu-btn i { font-size: 1.5rem; color: var(--primary-yellow); margin-bottom: 10px; }
        .menu-btn:hover { background: #252525; transform: translateY(-5px); border-color: var(--primary-yellow); }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px);
            z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: #181818; width: 90%; max-width: 600px; max-height: 85vh;
            border-radius: 24px; padding: 2rem; position: relative; border: 1px solid #333;
            transform: scale(0.9); transition: all 0.3s; overflow-y: auto; color: white;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .close-modal { position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }

        /* HP HEARTS */
        .hp-hearts { color: #E74C3C; font-size: 1.1rem; letter-spacing: 2px; margin: 5px 0; }
        .shop-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #333; font-size: 0.9rem; }
        .shop-price { background: #333; padding: 4px 10px; border-radius: 4px; color: var(--primary-yellow); font-weight: bold; font-size: 0.8rem; }

        /* MOBILE RESPONSIVE */
        @media (max-width: 768px) {
            .hero-text h1 { font-size: 2rem; }
            .podium-container { flex-direction: column; height: auto; align-items: center; margin-bottom: 2rem; }
            .rank-1, .rank-2, .rank-3 { width: 100%; max-width: 100%; height: auto; min-height: 80px; flex-direction: row; align-items: center; justify-content: space-between; padding: 15px; margin-bottom: 10px; transform: none; order: 0; }
            .rank-1 { order: -1; border-width: 2px; }
            .rank-1 .avatar-small { width: 40px; height: 40px; margin-right: 15px; }
            
            .list-container { grid-template-columns: 1fr; }
            .menu-grid { grid-template-columns: 2fr 2fr; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo"><i class="fas fa-bolt"></i> ENGLISH 8 ARENA</div>
        <div style="font-size:0.8rem; color:#888;">V6.0</div>
    </nav>

    <section class="hero">
        <div style="width: 100%; max-width: 500px; margin-bottom: 30px; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.5);">
            <iframe allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" frameborder="0" height="175" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/us/album/birds-of-a-feather/1739659134?i=1739659424"></iframe>
        </div>

        <h1 style="font-family: 'Fredoka'; font-size: 2.5rem; margin-bottom: 20px; color: white;">WELCOME PLAYER</h1>
        
        <div class="search-wrapper">
            <input type="text" id="searchInput" class="search-box" placeholder="Type your name..." oninput="showSuggestions(this.value)">
            <div id="suggestions" class="suggestions-box"></div>
        </div>

        <div id="vocab-display" class="vocab-card" style="display:none;">
            <div style="font-size:0.7rem; color:#666; text-transform:uppercase; letter-spacing:1px; margin-bottom:5px;">Vocab of the Day</div>
            <div class="vocab-word" id="v-word">Loading...</div>
            <div class="vocab-meaning" id="v-meaning">...</div>
            <div class="vocab-example" id="v-example">...</div>
        </div>

        <div class="menu-grid">
            <div class="menu-btn" onclick="openModal('rulesModal')">
                <i class="fas fa-book-dead"></i><br>Rules
            </div>
            <div class="menu-btn" onclick="openModal('shopModal')">
                <i class="fas fa-shopping-bag"></i><br>Shop
            </div>
            <div class="menu-btn" onclick="openModal('missionsModal')">
                <i class="fas fa-scroll"></i><br>Missions
            </div>
            <div class="menu-btn" onclick="openModal('libraryModal')">
                <i class="fas fa-book"></i><br>Library
            </div>
        </div>
    </section>

    <section style="padding: 1rem 5%;">
        <div class="section-title">LEADERBOARD</div>
        <p class="section-subtitle">Tap any name to see full profile</p>

        <div id="podium-display" class="podium-container">Loading Database...</div>

        <div id="list-display" class="list-container"></div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="openModal('fullLeaderboardModal')" class="btn" style="background:transparent; border:1px solid #333; color:#888; padding:10px 20px; border-radius:50px;">View All Players</button>
        </div>
    </section>

    <div id="profileModal" class="modal-overlay">
        <div class="modal-content" style="text-align: center;">
            <button onclick="closeModal('profileModal')" class="close-modal">&times;</button>
            <div id="profile-content"></div>
        </div>
    </div>

    <div id="shopModal" class="modal-overlay">
        <div class="modal-content">
            <button onclick="closeModal('shopModal')" class="close-modal">&times;</button>
            <h2 class="section-title" style="font-size: 1.8rem;">ITEM SHOP</h2>
            <div style="text-align:center; font-size:0.8rem; color:#888; margin-bottom:20px;">Use Gold to buy. Contact Ms. Raya to redeem.</div>
            
            <h3 style="color:var(--primary-yellow); margin-top:15px; font-size:1rem;">‚ö° CONSUMABLES</h3>
            <div class="shop-item"><div>üß™ <b>XP POTION</b> (Booster +5 di Tugas)</div><div class="shop-price">500 G</div></div>
            <div class="shop-item"><div>üîê <b>SECRET CODE</b> (Unlock Extra XP)</div><div class="shop-price">FREE</div></div>

            <h3 style="color:var(--primary-yellow); margin-top:15px; font-size:1rem;">üé™ PRIVILEGES</h3>
            <div class="shop-item"><div>üéµ DJ Pass (Request Song)</div><div class="shop-price">50 G</div></div>
            <div class="shop-item"><div>üöΩ VIP Toilet Pass</div><div class="shop-price">100 G</div></div>
            <div class="shop-item"><div>üß∏ Comfy Pass (Bantal)</div><div class="shop-price">200 G</div></div>
            <div class="shop-item"><div>üëë Custom Title</div><div class="shop-price">300 G</div></div>

            <h3 style="color:var(--primary-yellow); margin-top:15px; font-size:1rem;">üî• LEGENDARY</h3>
            <div class="shop-item"><div>üõ°Ô∏è Redemption (Hapus 1 Strike)</div><div class="shop-price">500 G</div></div>
            <div class="shop-item"><div>üé≤ Team Captain</div><div class="shop-price">600 G</div></div>
            <div class="shop-item"><div>üéüÔ∏è Homework Pass</div><div class="shop-price">1000 G</div></div>
        </div>
    </div>

    <div id="missionsModal" class="modal-overlay">
        <div class="modal-content">
            <button onclick="closeModal('missionsModal')" class="close-modal">&times;</button>
            <h2 class="section-title">MISSIONS</h2>
            <div id="missions-container" style="display:grid; gap:10px; margin-top:15px;">Loading...</div>
        </div>
    </div>
    <div id="libraryModal" class="modal-overlay">
        <div class="modal-content">
            <button onclick="closeModal('libraryModal')" class="close-modal">&times;</button>
            <h2 class="section-title">LIBRARY</h2>
            <div id="library-container" style="display:grid; gap:10px; margin-top:15px;">Loading...</div>
        </div>
    </div>
    <div id="rulesModal" class="modal-overlay">
        <div class="modal-content">
            <button onclick="closeModal('rulesModal')" class="close-modal">&times;</button>
            <h2 class="section-title">RULES</h2>
            <div style="margin-top:20px; line-height:1.6;">
                <p>1. <b>No Lanyard = No Exit.</b> (Denda -50 G)</p>
                <p>2. <b>No Book = Manual Writing.</b> (Denda -100 G)</p>
                <p>3. <b>Toxic Words = Muted.</b> (Denda -50 G)</p>
                <p>4. <b>0 HP = Game Over.</b> (Presentasi Materi)</p>
            </div>
        </div>
    </div>
    <div id="fullLeaderboardModal" class="modal-overlay">
        <div class="modal-content">
            <button onclick="closeModal('fullLeaderboardModal')" class="close-modal">&times;</button>
            <h2 class="section-title">ALL PLAYERS</h2>
            <div id="full-list-container" style="display:grid; gap:10px; margin-top:15px;"></div>
        </div>
    </div>

    <script>
        // --- LINKS CSV ---
        const LEADERBOARD_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXFMkHsaawvFVUVRMfkhlABiY0E3ohfLOpozxvwb3lqme-CrKBctX2kEZnZQRdlurfIlwx1rk-6fTQ/pub?gid=0&single=true&output=csv';
        const MISSIONS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXFMkHsaawvFVUVRMfkhlABiY0E3ohfLOpozxvwb3lqme-CrKBctX2kEZnZQRdlurfIlwx1rk-6fTQ/pub?gid=1940746558&single=true&output=csv';
        const LIBRARY_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXFMkHsaawvFVUVRMfkhlABiY0E3ohfLOpozxvwb3lqme-CrKBctX2kEZnZQRdlurfIlwx1rk-6fTQ/pub?gid=1636803017&single=true&output=csv';
        const VOCAB_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXFMkHsaawvFVUVRMfkhlABiY0E3ohfLOpozxvwb3lqme-CrKBctX2kEZnZQRdlurfIlwx1rk-6fTQ/pub?gid=36241624&single=true&output=csv';

        let allPlayers = []; 

        async function init() {
            await fetchLeaderboard();
            fetchVocab();
        }

        // --- 1. FETCH LEADERBOARD ---
        async function fetchLeaderboard() {
            try {
                const res = await fetch(LEADERBOARD_URL);
                const text = await res.text();
                const rows = text.split('\n').slice(1);
                
                allPlayers = rows.map(row => {
                    const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return {
                        rank: c[0]?.replace(/"/g, '').trim(),
                        name: c[1]?.replace(/"/g, '').trim(),
                        xp: c[2]?.replace(/"/g, '').trim(),
                        tier: c[3]?.replace(/"/g, '').trim(),
                        debt: c[5]?.replace(/"/g, '').trim() || '',
                        hp: parseInt(c[6]?.replace(/"/g, '').trim() || '100'), 
                        gold: c[7]?.replace(/"/g, '').trim() || '0'
                    };
                }).filter(p => p.name && p.rank);

                renderLeaderboard(allPlayers);
                renderFullList(allPlayers);

            } catch (e) { console.error('Leaderboard Error:', e); }
        }

        // --- 2. RENDER FUNCTIONS ---
        function renderLeaderboard(players) {
            // Podium Top 3
            const top3 = players.slice(0, 3);
            let podiumHtml = '';
            
            top3.forEach((p, i) => {
                let rankClass = i === 0 ? 'rank-1' : i === 1 ? 'rank-2' : 'rank-3';
                let medal = i === 0 ? 'üëë' : i === 1 ? 'ü•à' : 'ü•â';
                
                podiumHtml += `
                <div class="podium-card ${rankClass}" onclick="openProfileByName('${p.name}')">
                    <div style="font-size:2rem; margin-bottom:5px;">${medal}</div>
                    <div style="font-weight:bold; font-size:0.9rem;">${p.name}</div>
                    <div style="color:var(--primary-yellow); font-weight:800;">${p.xp} XP</div>
                    <div class="hp-hearts">${getHearts(p.hp)}</div>
                </div>`;
            });
            document.getElementById('podium-display').innerHTML = podiumHtml;

            // List Rank 4-9
            const listPlayers = players.slice(3, 9);
            document.getElementById('list-display').innerHTML = listPlayers.map(p => `
                <div class="player-row" onclick="openProfileByName('${p.name}')">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <div style="font-weight:bold; color:#666; width:25px;">#${p.rank}</div>
                        <div style="font-weight:600; font-size:0.9rem;">${p.name}</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="color:var(--primary-yellow); font-weight:bold; font-size:0.9rem;">${p.xp} XP</div>
                    </div>
                </div>
            `).join('');
        }

        function renderFullList(players) {
            document.getElementById('full-list-container').innerHTML = players.map(p => `
                <div class="player-row" onclick="openProfileByName('${p.name}')">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <div style="color:#666; width:30px;">#${p.rank}</div>
                        <div>${p.name}</div>
                    </div>
                    <div style="color:var(--primary-yellow);">${p.xp} XP</div>
                </div>
            `).join('');
        }

        // --- 3. HEART GENERATOR ‚ù§Ô∏è ---
        function getHearts(hp) {
            // 1 Heart = 20 HP
            let html = '';
            let full = Math.floor(hp / 20);
            let half = (hp % 20) >= 10 ? 1 : 0;
            let empty = 5 - full - half;

            for(let i=0; i<full; i++) html += '<i class="fas fa-heart"></i>';
            if(half) html += '<i class="fas fa-heart-half-stroke"></i>';
            for(let i=0; i<empty; i++) html += '<i class="far fa-heart"></i>';
            return html;
        }

        // --- 4. PROFILE & SEARCH LOGIC ---
        function showSuggestions(val) {
            const box = document.getElementById('suggestions');
            if(val.length < 1) { box.style.display = 'none'; return; }
            
            const matches = allPlayers.filter(p => p.name.toLowerCase().includes(val.toLowerCase()));
            if(matches.length > 0) {
                box.innerHTML = matches.map(p => `<div class="suggestion-item" onclick="openProfileByName('${p.name}')">${p.name}</div>`).join('');
                box.style.display = 'block';
            } else {
                box.style.display = 'none';
            }
        }

        function openProfileByName(name) {
            const p = allPlayers.find(x => x.name === name);
            if(!p) return;

            // Generate Profile HTML
            const html = `
                <img src="https://api.dicebear.com/7.x/notionists/svg?seed=${p.name}&backgroundColor=F4D03F" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--primary-yellow); margin-bottom:15px;">
                <h2 style="font-family:'Fredoka'; color:var(--primary-yellow); margin-bottom:5px;">${p.name}</h2>
                <div style="background:#333; display:inline-block; padding:4px 12px; border-radius:20px; font-size:0.8rem; color:#ccc; margin-bottom:20px;">${p.tier}</div>
                
                <div class="hp-hearts" style="font-size:1.5rem; margin-bottom:20px;">${getHearts(p.hp)} <span style="font-size:0.8rem; color:#888;">(${p.hp}/100)</span></div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;">
                    <div class="glass-card" style="padding:15px; text-align:center;">
                        <div style="font-size:1.5rem; font-weight:bold; color:white;">${p.xp}</div>
                        <div style="font-size:0.7rem; color:#888;">Total XP</div>
                    </div>
                    <div class="glass-card" style="padding:15px; text-align:center;">
                        <div style="font-size:1.5rem; font-weight:bold; color:var(--primary-yellow);">${p.gold}</div>
                        <div style="font-size:0.7rem; color:#888;">Gold</div>
                    </div>
                </div>

                <div style="background:#1A1A1A; padding:15px; border-radius:10px; text-align:left; border:1px solid #333;">
                    <div style="font-size:0.8rem; color:#666; margin-bottom:5px; text-transform:uppercase;">Quest Status</div>
                    ${p.debt ? `<div style="color:var(--accent-red); font-weight:bold;"><i class="fas fa-exclamation-circle"></i> MISSING: ${p.debt}</div>` 
                             : `<div style="color:var(--accent-green); font-weight:bold;"><i class="fas fa-check-circle"></i> All Missions Cleared</div>`}
                </div>
            `;
            
            document.getElementById('profile-content').innerHTML = html;
            document.getElementById('suggestions').style.display = 'none';
            document.getElementById('searchInput').value = '';
            openModal('profileModal');
        }

        // --- 5. VOCAB OF THE DAY (RANDOM) ---
        async function fetchVocab() {
            try {
                const res = await fetch(VOCAB_URL);
                const text = await res.text();
                const rows = text.split('\n').slice(1);
                // Pilih Random 1 Kata
                const randomRow = rows[Math.floor(Math.random() * rows.length)];
                if(randomRow) {
                    const c = randomRow.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    document.getElementById('v-word').innerText = c[0].replace(/"/g,'');
                    document.getElementById('v-meaning').innerText = c[1].replace(/"/g,'');
                    document.getElementById('v-example').innerText = `"${c[2].replace(/"/g,'')}"`;
                    document.getElementById('vocab-display').style.display = 'block';
                }
            } catch(e) {}
        }

        // --- 6. MISSIONS & LIBRARY FETCH (SAME AS BEFORE) ---
        async function fetchMissions() {
            try {
                const res = await fetch(MISSIONS_URL);
                const text = await res.text();
                const rows = text.split('\n').slice(1);
                document.getElementById('missions-container').innerHTML = rows.map(row => {
                    const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (!c[1]) return '';
                    
                    // Late Checker Logic (Simple String Check or Date)
                    let isLate = false; 
                    // Kalau mau logic tanggal beneran, butuh format YYYY-MM-DD di CSV
                    
                    return `<div style="background:#222; padding:15px; border-radius:10px; border-left:4px solid var(--primary-yellow); position:relative;">
                        <div style="font-weight:bold; color:var(--primary-yellow);">${c[0]?.replace(/"/g,'')}</div>
                        <div style="font-size:1rem;">${c[1]?.replace(/"/g,'')}</div>
                        <div style="font-size:0.8rem; color:#888; margin-top:5px;">Due: ${c[2]?.replace(/"/g,'')}</div>
                        ${c[4] ? `<a href="${c[4].replace(/"/g,'')}" target="_blank" class="btn" style="background:var(--primary-yellow); color:black; margin-top:10px; font-size:0.8rem; padding:8px 15px; display:inline-block; border-radius:5px; text-decoration:none;">SUBMIT</a>` : ''}
                    </div>`;
                }).join('');
            } catch(e) {}
        }

        async function fetchLibrary() {
            try {
                const res = await fetch(LIBRARY_URL);
                const text = await res.text();
                const rows = text.split('\n').slice(1);
                document.getElementById('library-container').innerHTML = rows.map(row => {
                    const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (!c[1]) return '';
                    return `<a href="${c[2]?.replace(/"/g,'')}" target="_blank" style="text-decoration:none; color:white;">
                        <div style="background:#222; padding:15px; border-radius:10px; display:flex; align-items:center; gap:15px;">
                            <i class="fas fa-book" style="color:var(--primary-yellow);"></i>
                            <div><div style="font-weight:bold;">${c[1]?.replace(/"/g,'')}</div><div style="font-size:0.8rem; color:#888;">${c[0]?.replace(/"/g,'')}</div></div>
                        </div>
                    </a>`;
                }).join('');
            } catch(e) {}
        }

        // --- MODAL UTILS ---
        function openModal(id) {
            document.getElementById(id).classList.add('active');
            document.body.style.overflow = 'hidden';
            if(id === 'missionsModal') fetchMissions();
            if(id === 'libraryModal') fetchLibrary();
        }
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        window.onclick = function(e) { if(e.target.classList.contains('modal-overlay')) e.target.classList.remove('active'); }

        // Start App
        init();

    </script>
</body>
</html>
